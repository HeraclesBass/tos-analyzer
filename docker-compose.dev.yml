version: '3.8'
services:
  tos-analyzer-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: tos-analyzer-dev
    ports:
    - 8103:8103
    environment:
    - NODE_ENV=development
    - PORT=8103
    - DATABASE_URL=postgresql://user:password@tos-analyzer-postgres:5432/hercules_db
    - REDIS_URL=redis://tos-analyzer-redis:6379
    - GEMINI_API_KEY=${GEMINI_API_KEY}
    - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
    - NEXT_PUBLIC_APP_URL=https://tos-dev.herakles.dev
    - RATE_LIMIT_PER_MINUTE=${RATE_LIMIT_PER_MINUTE:-10}
    - ANALYTICS_ENABLED=${ANALYTICS_ENABLED:-true}
    - WATCHPACK_POLLING=true
    volumes:
    - ./app:/app/app
    - ./components:/app/components
    - ./lib:/app/lib
    - ./public:/app/public
    - ./prisma:/app/prisma
    - ./next.config.js:/app/next.config.js
    - ./tailwind.config.js:/app/tailwind.config.js
    - ./tsconfig.json:/app/tsconfig.json
    - /app/node_modules
    - /app/.next
    networks:
    - tos-analyzer_default
    restart: unless-stopped
    command: npm run dev
    logging:
      driver: loki
      options:
        loki-url: http://localhost:3100/loki/api/v1/push
        loki-batch-size: '400'
        loki-retries: '5'
        loki-external-labels: service=tos-analyzer-dev,environment=development,type=api
networks:
  tos-analyzer_default:
    external: true
